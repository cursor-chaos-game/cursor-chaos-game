<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chaos Runner</title>
    <style>
        /* TASARIM KODLARI (AynÄ± GÃ¶rÃ¼nÃ¼m Korundu) */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { font-family: 'Segoe UI', sans-serif; overflow: hidden; background: #000; touch-action: none; }
        
        .screen { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: radial-gradient(circle at center, #1a1a2e 0%, #000000 100%);
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            color: white; z-index: 200; 
        }

        h1 { 
            font-size: clamp(40px, 8vw, 80px); 
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #ffe66d); 
            -webkit-background-clip: text; color: transparent; 
            margin-bottom: 10px; text-align: center; font-weight: 900; letter-spacing: -2px;
        }

        .subtitle { color: #888; margin-bottom: 40px; font-size: 18px; }

        .btn-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; max-width: 600px; }
        
        button { 
            padding: 15px 40px; font-size: 20px; font-weight: bold; border: none; border-radius: 50px; 
            cursor: pointer; color: white; transition: transform 0.2s; min-width: 160px;
            box-shadow: 0 0 20px rgba(255,255,255,0.1);
        }
        button:active { transform: scale(0.95); }
        
        .btn-play { background: linear-gradient(45deg, #ff6b6b, #ee5253); box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3); }
        .btn-shop { background: linear-gradient(45deg, #4ecdc4, #22a6b3); box-shadow: 0 10px 30px rgba(78, 205, 196, 0.3); }
        .btn-secondary { background: linear-gradient(45deg, #54a0ff, #2e86de); }
        
        /* OYUN UI */
        #gameCanvas { display: block; width: 100%; height: 100%; }
        #uiLayer { position: fixed; top: 20px; left: 20px; color: white; font-size: 20px; pointer-events: none; display: none; }
        .stat-box { background: rgba(0,0,0,0.5); padding: 10px 20px; border-radius: 15px; margin-bottom: 10px; backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.1); }
        
        /* MAÄAZA & DÄ°ÄER EKRANLAR */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 300; flex-direction: column; align-items: center; justify-content: center; }
        .shop-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; padding: 20px; max-height: 70vh; overflow-y: auto; }
        .shop-item { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 15px; text-align: center; border: 2px solid transparent; }
        .close-btn { margin-top: 20px; background: #555; }

        /* ANTI-CHEAT */
        #watermark { position: fixed; bottom: 5px; right: 5px; color: #333; font-size: 10px; pointer-events: none; }
    </style>
</head>
<body>

    <div id="menuScreen" class="screen">
        <h1>CHAOS RUNNER</h1>
        <div class="subtitle">KaranlÄ±ktan KaÃ§, IÅŸÄ±ÄŸÄ± Bul</div>
        
        <div class="stat-box" style="margin-bottom: 30px;">
            ğŸ’ <span id="menuCrystals">0</span> Kristal
        </div>

        <div class="btn-container">
            <button class="btn-play" onclick="game.start()">ğŸ® OYNA</button>
            <button class="btn-shop" onclick="ui.openShop()">ğŸ›’ MAÄAZA</button>
            <button class="btn-secondary" onclick="alert('Liderlik tablosu yakÄ±nda!')">ğŸ† LÄ°DERLER</button>
            <button class="btn-secondary" onclick="ui.toggleSettings()">âš™ï¸ AYARLAR</button>
        </div>
        
        <div style="margin-top: 30px; color: #666; font-size: 14px;">
            ğŸ† En YÃ¼ksek: <span id="bestWave">1</span>. Dalga
        </div>
    </div>

    <div id="uiLayer">
        <div class="stat-box">ğŸ’¯ Skor: <span id="scoreDisplay">0</span></div>
        <div class="stat-box">â¤ï¸ Can: <span id="healthDisplay">3</span></div>
        <div class="stat-box">ğŸŒŠ Dalga: <span id="waveDisplay">1</span></div>
    </div>

    <div id="shopScreen" class="modal">
        <h2 style="color:white; margin-bottom:20px;">ğŸ›’ MARKET</h2>
        <div class="shop-grid" id="shopContent">
            </div>
        <button class="close-btn" onclick="ui.closeShop()">KAPAT</button>
    </div>

    <div id="gameOverScreen" class="modal">
        <h1 style="color:#ff6b6b">OYUN BÄ°TTÄ°</h1>
        <div class="stat-box">Skor: <span id="finalScore">0</span></div>
        <div class="stat-box">KazanÄ±lan Kristal: <span id="finalCrystals">0</span></div>
        <button class="btn-play" onclick="game.start()">TEKRAR OYNA</button>
        <button class="close-btn" onclick="ui.toMenu()">MENÃœYE DÃ–N</button>
    </div>

    <canvas id="gameCanvas"></canvas>
    <div id="watermark">v2.0 Secure Build</div>

<script>
/**
 * CHAOS RUNNER - GÃœVENLÄ° SÃœRÃœM v2.0
 * Hata korumalÄ±, otomatik baÅŸlatmalÄ± motor.
 */

// --- DEPOLAMA SÄ°STEMÄ° (Hata Vermez) ---
const Storage = {
    get: (key, def) => {
        try {
            return localStorage.getItem(key) || def;
        } catch(e) { return def; }
    },
    set: (key, val) => {
        try {
            localStorage.setItem(key, val);
        } catch(e) {}
    }
};

// --- OYUN VERÄ°LERÄ° ---
const Data = {
    crystals: parseInt(Storage.get('crystals', 0)),
    bestWave: parseInt(Storage.get('bestWave', 1)),
    ownedSkins: JSON.parse(Storage.get('skins', '["classic"]')),
    currentSkin: Storage.get('currentSkin', 'classic')
};

// --- UI KONTROL ---
const ui = {
    screens: {
        menu: document.getElementById('menuScreen'),
        game: document.getElementById('uiLayer'),
        shop: document.getElementById('shopScreen'),
        gameOver: document.getElementById('gameOverScreen')
    },
    
    init: function() {
        this.updateStats();
    },

    updateStats: function() {
        document.getElementById('menuCrystals').innerText = Data.crystals;
        document.getElementById('bestWave').innerText = Data.bestWave;
    },

    openShop: function() {
        this.screens.shop.style.display = 'flex';
        const grid = document.getElementById('shopContent');
        grid.innerHTML = ''; // Temizle
        
        // Basit MaÄŸaza Ã–ÄŸeleri
        const items = [
            { name: 'Ekstra Can', price: 100, icon: 'â¤ï¸', type: 'boost' },
            { name: 'HÄ±z', price: 50, icon: 'âš¡', type: 'boost' },
            { name: 'Kalkan', price: 150, icon: 'ğŸ›¡ï¸', type: 'boost' }
        ];

        items.forEach(item => {
            const div = document.createElement('div');
            div.className = 'shop-item';
            div.style.color = 'white';
            div.innerHTML = `
                <div style="font-size:30px">${item.icon}</div>
                <div>${item.name}</div>
                <div style="color:#ffd700">ğŸ’ ${item.price}</div>
                <button style="padding:5px 15px; min-width:auto; margin-top:5px; font-size:14px;" 
                onclick="ui.buyItem(${item.price})">AL</button>
            `;
            grid.appendChild(div);
        });
    },

    closeShop: function() {
        this.screens.shop.style.display = 'none';
    },

    buyItem: function(price) {
        if(Data.crystals >= price) {
            Data.crystals -= price;
            Storage.set('crystals', Data.crystals);
            this.updateStats();
            alert('SatÄ±n alÄ±ndÄ±! (Bir sonraki oyunda aktif)');
        } else {
            alert('Yetersiz Kristal!');
        }
    },

    toMenu: function() {
        this.screens.gameOver.style.display = 'none';
        this.screens.game.style.display = 'none';
        this.screens.menu.style.display = 'flex';
        this.updateStats();
    },

    toggleSettings: function() {
        alert("Ses ve MÃ¼zik: AÃ‡IK\nTitreÅŸim: AÃ‡IK");
    }
};

// --- OYUN MOTORU ---
const game = {
    canvas: document.getElementById('gameCanvas'),
    ctx: document.getElementById('gameCanvas').getContext('2d'),
    isRunning: false,
    width: window.innerWidth,
    height: window.innerHeight,
    
    state: {
        player: { x:0, y:0, r:20, color:'#4ecdc4', tx:0, ty:0 },
        enemies: [],
        score: 0,
        health: 3,
        wave: 1
    },

    start: function() {
        // EkranlarÄ± ayarla
        ui.screens.menu.style.display = 'none';
        ui.screens.gameOver.style.display = 'none';
        ui.screens.game.style.display = 'block';
        
        // Oyunu sÄ±fÄ±rla
        this.width = window.innerWidth;
        this.height = window.innerHeight;
        this.canvas.width = this.width;
        this.canvas.height = this.height;
        
        this.state.player.x = this.width / 2;
        this.state.player.y = this.height / 2;
        this.state.player.tx = this.state.player.x;
        this.state.player.ty = this.state.player.y;
        
        this.state.score = 0;
        this.state.health = 3;
        this.state.wave = 1;
        this.state.enemies = [];
        
        this.isRunning = true;
        this.spawnWave();
        this.loop();
    },

    spawnWave: function() {
        document.getElementById('waveDisplay').innerText = this.state.wave;
        for(let i=0; i<3 + this.state.wave; i++) {
            this.state.enemies.push({
                x: Math.random() < 0.5 ? -50 : this.width + 50,
                y: Math.random() * this.height,
                s: 2 + (this.state.wave * 0.2), // HÄ±z
                r: 15 // YarÄ±Ã§ap
            });
        }
    },

    update: function() {
        const p = this.state.player;
        
        // Oyuncu hareketi (YumuÅŸak takip)
        const dx = p.tx - p.x;
        const dy = p.ty - p.y;
        if(Math.abs(dx) > 1 || Math.abs(dy) > 1) {
            p.x += dx * 0.1;
            p.y += dy * 0.1;
        }

        // DÃ¼ÅŸmanlar
        this.state.enemies.forEach((e, i) => {
            const angle = Math.atan2(p.y - e.y, p.x - e.x);
            e.x += Math.cos(angle) * e.s;
            e.y += Math.sin(angle) * e.s;

            // Ã‡arpÄ±ÅŸma
            const dist = Math.sqrt((p.x-e.x)**2 + (p.y-e.y)**2);
            if(dist < p.r + e.r) {
                this.state.health--;
                this.state.enemies.splice(i, 1);
                this.updateUI();
                if(this.state.health <= 0) this.gameOver();
            }
        });

        // Skor artÄ±ÅŸÄ± (zamanla)
        if(Math.random() < 0.05) {
            this.state.score++;
            this.updateUI();
        }

        // TÃ¼m dÃ¼ÅŸmanlar Ã¶ldÃ¼ mÃ¼?
        if(this.state.enemies.length === 0) {
            this.state.wave++;
            this.spawnWave();
        }
    },

    draw: function() {
        this.ctx.fillStyle = '#1a1a2e';
        this.ctx.fillRect(0, 0, this.width, this.height);

        // Oyuncu
        this.ctx.beginPath();
        this.ctx.arc(this.state.player.x, this.state.player.y, this.state.player.r, 0, Math.PI*2);
        this.ctx.fillStyle = this.state.player.color;
        this.ctx.shadowBlur = 20;
        this.ctx.shadowColor = this.state.player.color;
        this.ctx.fill();
        this.ctx.shadowBlur = 0;

        // DÃ¼ÅŸmanlar
        this.ctx.fillStyle = '#ff6b6b';
        this.state.enemies.forEach(e => {
            this.ctx.beginPath();
            this.ctx.arc(e.x, e.y, e.r, 0, Math.PI*2);
            this.ctx.fill();
        });
    },

    loop: function() {
        if(!this.isRunning) return;
        this.update();
        this.draw();
        requestAnimationFrame(() => this.loop());
    },

    updateUI: function() {
        document.getElementById('scoreDisplay').innerText = this.state.score;
        document.getElementById('healthDisplay').innerText = "â¤ï¸".repeat(this.state.health);
    },

    gameOver: function() {
        this.isRunning = false;
        Data.crystals += Math.floor(this.state.score / 10);
        if(this.state.wave > Data.bestWave) Data.bestWave = this.state.wave;
        Storage.set('crystals', Data.crystals);
        Storage.set('bestWave', Data.bestWave);

        document.getElementById('finalScore').innerText = this.state.score;
        document.getElementById('finalCrystals').innerText = Math.floor(this.state.score / 10);
        
        ui.screens.game.style.display = 'none';
        ui.screens.gameOver.style.display = 'flex';
    }
};

// --- GÄ°RÄ°Å KONTROLLERÄ° ---
window.addEventListener('load', () => ui.init());

// Dokunmatik ve Mouse
const moveHandler = (e) => {
    e.preventDefault();
    const x = e.touches ? e.touches[0].clientX : e.clientX;
    const y = e.touches ? e.touches[0].clientY : e.clientY;
    game.state.player.tx = x;
    game.state.player.ty = y;
};

window.addEventListener('touchmove', moveHandler, {passive: false});
window.addEventListener('mousemove', moveHandler);
window.addEventListener('touchstart', moveHandler, {passive: false});

// Yeniden boyutlandÄ±rma
window.addEventListener('resize', () => {
    game.width = window.innerWidth;
    game.height = window.innerHeight;
    game.canvas.width = game.width;
    game.canvas.height = game.height;
});

</script>
</body>
</html>
